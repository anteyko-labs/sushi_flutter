# 🗄️ АРХИТЕКТУРА БАЗЫ ДАННЫХ SUSHI EXPRESS

## 📊 Общая информация
- **Тип БД**: SQLite
- **Файл**: `sushi_express.db`
- **ORM**: SQLAlchemy (Flask-SQLAlchemy)
- **Количество таблиц**: 10
- **Общий объем данных**: 267 записей

## 🏗️ СТРУКТУРА ТАБЛИЦ

### 👥 1. USERS (Пользователи)
```
┌─────────────────────────────────────────┐
│                USERS                    │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  name (TEXT) - Имя пользователя      │
│ ⚠️  email (TEXT) - Email (уникальный)   │
│ ⚠️  phone (TEXT) - Телефон              │
│    location (TEXT) - Адрес              │
│ ⚠️  password_hash (TEXT) - Хеш пароля   │
│    loyalty_points (INTEGER) - Бонусы    │
│    favorites (TEXT) - Избранное (JSON)  │
│    cart (TEXT) - Корзина (JSON)         │
│    created_at (TIMESTAMP) - Дата создания│
│    last_login_at (TIMESTAMP) - Последний вход│
│    is_active (BOOLEAN) - Активность     │
│    is_admin (BOOLEAN) - Права админа    │
└─────────────────────────────────────────┘
```
**Записей**: 2 (включая админа)

---

### 🥢 2. ROLLS (Роллы)
```
┌─────────────────────────────────────────┐
│                ROLLS                    │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  name (TEXT) - Название ролла        │
│ ⚠️  cost_price (REAL) - Себестоимость   │
│ ⚠️  sale_price (REAL) - Цена продажи    │
│    image_url (TEXT) - URL картинки      │
│    is_popular (BOOLEAN) - Популярный    │
│    is_new (BOOLEAN) - Новинка           │
│    created_at (TIMESTAMP) - Дата создания│
│    updated_at (TIMESTAMP) - Дата обновления│
│    description (TEXT) - Описание        │
└─────────────────────────────────────────┘
```
**Записей**: 25 роллов

---

### 🥗 3. INGREDIENTS (Ингредиенты)
```
┌─────────────────────────────────────────┐
│              INGREDIENTS                │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  name (TEXT) - Название ингредиента  │
│ ⚠️  cost_per_unit (REAL) - Стоимость за единицу│
│ ⚠️  price_per_unit (REAL) - Цена за единицу│
│    stock_quantity (REAL) - Остаток      │
│ ⚠️  unit (TEXT) - Единица измерения     │
│    created_at (TIMESTAMP) - Дата создания│
│    updated_at (TIMESTAMP) - Дата обновления│
└─────────────────────────────────────────┘
```
**Записей**: 53 ингредиента

---

### 🍱 4. SETS (Сеты)
```
┌─────────────────────────────────────────┐
│                SETS                     │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  name (TEXT) - Название сета         │
│ ⚠️  cost_price (REAL) - Себестоимость   │
│ ⚠️  set_price (REAL) - Цена сета        │
│    discount_percent (REAL) - Скидка %   │
│    is_popular (BOOLEAN) - Популярный    │
│    is_new (BOOLEAN) - Новинка           │
│    created_at (TIMESTAMP) - Дата создания│
│    updated_at (TIMESTAMP) - Дата обновления│
│    description (TEXT) - Описание        │
│    image_url (TEXT) - URL картинки      │
└─────────────────────────────────────────┘
```
**Записей**: 14 сетов

---

### 🍶 5. OTHER_ITEMS (Дополнительные товары)
```
┌─────────────────────────────────────────┐
│             OTHER_ITEMS                 │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  name (VARCHAR) - Название товара    │
│    description (TEXT) - Описание        │
│ ⚠️  cost_price (FLOAT) - Себестоимость  │
│ ⚠️  sale_price (FLOAT) - Цена продажи   │
│ ⚠️  category (VARCHAR) - Категория      │
│    image_url (VARCHAR) - URL картинки   │
│    stock_quantity (FLOAT) - Остаток     │
│    unit (VARCHAR) - Единица измерения   │
│    is_popular (BOOLEAN) - Популярный    │
│    is_new (BOOLEAN) - Новинка           │
│    created_at (DATETIME) - Дата создания│
│    updated_at (DATETIME) - Дата обновления│
└─────────────────────────────────────────┘
```
**Записей**: 9 товаров (соусы, напитки)

---

### 📦 6. ROLL_INGREDIENTS (Состав роллов)
```
┌─────────────────────────────────────────┐
│           ROLL_INGREDIENTS              │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  roll_id (INTEGER) → rolls.id       │
│ ⚠️  ingredient_id (INTEGER) → ingredients.id│
│ ⚠️  amount_per_roll (REAL) - Количество │
└─────────────────────────────────────────┘
```
**Записей**: 120 связей (состав роллов)

---

### 🍱 7. SET_ROLLS (Состав сетов)
```
┌─────────────────────────────────────────┐
│              SET_ROLLS                  │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  set_id (INTEGER) → sets.id         │
│ ⚠️  roll_id (INTEGER) → rolls.id       │
│    quantity (INTEGER) - Количество      │
└─────────────────────────────────────────┘
```
**Записей**: 58 связей (состав сетов)

---

### 📋 8. ORDERS (Заказы)
```
┌─────────────────────────────────────────┐
│               ORDERS                    │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  user_id (INTEGER) → users.id       │
│ ⚠️  phone (TEXT) - Телефон для связи   │
│ ⚠️  delivery_address (TEXT) - Адрес доставки│
│ ⚠️  payment_method (TEXT) - Способ оплаты│
│    status (TEXT) - Статус заказа        │
│ ⚠️  total_price (REAL) - Общая стоимость│
│    comment (TEXT) - Комментарий         │
│    created_at (TIMESTAMP) - Дата создания│
│    updated_at (TIMESTAMP) - Дата обновления│
└─────────────────────────────────────────┘
```
**Записей**: 0 (пока заказов нет)

---

### 🛒 9. ORDER_ITEMS (Элементы заказов)
```
┌─────────────────────────────────────────┐
│            ORDER_ITEMS                  │
├─────────────────────────────────────────┤
│ 🔑 id (INTEGER) - Primary Key          │
│ ⚠️  order_id (INTEGER) → orders.id     │
│ ⚠️  item_type (TEXT) - Тип товара      │
│ ⚠️  item_id (INTEGER) - ID товара      │
│ ⚠️  quantity (INTEGER) - Количество     │
│ ⚠️  unit_price (REAL) - Цена за единицу│
│ ⚠️  total_price (REAL) - Общая цена    │
└─────────────────────────────────────────┘
```
**Записей**: 0 (пока заказов нет)

---

## 🔗 СХЕМА СВЯЗЕЙ

```
USERS (2 записи)
    │
    ├─ ORDERS (0 записей)
    │     │
    │     └─ ORDER_ITEMS (0 записей)
    │
    ├─ favorites (JSON в таблице users)
    └─ cart (JSON в таблице users)

INGREDIENTS (53 записи)
    │
    └─ ROLL_INGREDIENTS (120 записей)
            │
            └─ ROLLS (25 записей)

ROLLS (25 записей)
    │
    └─ SET_ROLLS (58 записей)
            │
            └─ SETS (14 записей)

OTHER_ITEMS (9 записей)
    └─ [Будут добавлены в состав сетов]
```

## 📊 СТАТИСТИКА ДАННЫХ

| Таблица | Записей | Описание |
|---------|---------|----------|
| `users` | 2 | Пользователи (включая админа) |
| `rolls` | 25 | Роллы |
| `sets` | 14 | Сеты |
| `ingredients` | 53 | Ингредиенты |
| `other_items` | 9 | Дополнительные товары |
| `roll_ingredients` | 120 | Состав роллов |
| `set_rolls` | 58 | Состав сетов |
| `orders` | 0 | Заказы (пока пусто) |
| `order_items` | 0 | Элементы заказов (пока пусто) |

## 🏗️ ТЕХНОЛОГИЧЕСКИЙ СТЕК

### Backend (Python)
- **Фреймворк**: Flask
- **ORM**: SQLAlchemy (Flask-SQLAlchemy)
- **База данных**: SQLite
- **Аутентификация**: JWT (Flask-JWT-Extended)
- **CORS**: Flask-CORS

### Frontend (Flutter/Dart)
- **UI Framework**: Flutter
- **HTTP клиент**: HTTP package
- **Состояние**: Provider/Riverpod
- **Навигация**: Flutter Navigator

## 🔄 ПРИНЦИПЫ РАБОТЫ

### 1. **Пользователи**
- Регистрация/авторизация через JWT токены
- Избранное и корзина хранятся как JSON в таблице `users`
- Поддержка ролей (обычный пользователь/админ)

### 2. **Продукты**
- **Роллы**: основные продукты с составом из ингредиентов
- **Сеты**: комбинации роллов с автоматическим расчетом цены
- **Дополнительные товары**: соусы, напитки и т.д.

### 3. **Состав продуктов**
- **Роллы**: связь через `roll_ingredients` с количеством ингредиентов
- **Сеты**: связь через `set_rolls` с количеством роллов
- Автоматический расчет себестоимости

### 4. **Заказы**
- Структура готова, но пока не используется
- Поддержка различных типов товаров в одном заказе

## 🚀 ОСОБЕННОСТИ АРХИТЕКТУРЫ

1. **Гибкость**: JSON поля для корзины и избранного
2. **Масштабируемость**: нормализованная структура БД
3. **Производительность**: индексы на внешние ключи
4. **Безопасность**: хеширование паролей, JWT токены
5. **Расширяемость**: легко добавить новые типы товаров

## 📈 ПЛАНЫ РАЗВИТИЯ

1. **Заказы**: интеграция с системой заказов
2. **Аналитика**: добавление метрик продаж
3. **Инвентарь**: управление остатками
4. **Уведомления**: система уведомлений
5. **Платежи**: интеграция с платежными системами
